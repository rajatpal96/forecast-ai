<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu Chatbot</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            overflow: hidden;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Chat container styling */
        .chat-container {
            width: 80%;
            max-width: 1200px;
            height: 90%;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        /* Chat header styling */
        .chat-header {
            background: linear-gradient(135deg, #0078d7, #005bb5);
            padding: 30px;
            text-align: center;
            color: white;
            font-size: 30px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Chat body styling */
        .chat-body {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f3f4f6;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* Chat bubbles for messages */
        .chat-message {
            max-width: 75%;
            padding: 20px;
            font-size: 18px;
            border-radius: 15px;
            word-wrap: break-word;
            line-height: 1.6;
        }

        .chat-message.bot {
            align-self: flex-start;
            background-color: #e8effc;
            color: #0c233b;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .chat-message.user {
            align-self: flex-end;
            background-color: #0078d7;
            color: white;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        /* Menu card styling */
        .menu-card {
            display: flex;
            flex-direction: column;
            gap: 10px;
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-size: 18px;
            line-height: 1.8;
            word-wrap: break-word;
        }

        .menu-card h3 {
            margin-bottom: 10px;
            font-weight: bold;
            color: #0078d7;
            font-size: 22px;
        }

        .menu-card p {
            margin: 0;
            color: #333333;
        }

        .menu-card span {
            font-weight: bold;
            color: #0078d7;
        }

        /* Chat footer styling */
        .chat-footer {
            display: flex;
            padding: 20px;
            background-color: #ffffff;
            border-top: 1px solid #dee2e6;
        }

        .chat-footer input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 18px;
            outline: none;
            margin-right: 15px;
            box-shadow: 0 8px 10px rgba(0, 0, 0, 0.1);
        }

        .chat-footer button {
            padding: 15px 25px;
            background: #0078d7;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.3s ease;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .chat-footer button:hover {
            background-color: #005bb5;
            transform: translateY(-2px);
        }

        /* Loading spinner styling */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
            text-align: center;
        }

        .loading-spinner div {
            width: 18px;
            height: 18px;
            margin: 5px;
            background-color: #0078d7;
            border-radius: 50%;
            animation: bounce 1.2s infinite ease-in-out;
        }

        .loading-spinner div:nth-child(1) {
            animation-delay: -0.3s;
        }

        .loading-spinner div:nth-child(2) {
            animation-delay: -0.15s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
<div class="chat-container">
    <div class="chat-header">Restaurant Menu Chatbot</div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-footer">
        <input
                type="text"
                id="userInput"
                placeholder="Ask me about the menu (e.g., Show me vegetarian pizzas)"
        />
        <button id="sendButton">Send</button>
    </div>
</div>

<script>
    const chatBody = document.getElementById("chatBody");
    const userInput = document.getElementById("userInput");
    const sendButton = document.getElementById("sendButton");

    // Function to add a message to the chat
    function addMessage(text, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.textContent = text;
        messageDiv.classList.add("chat-message", sender);
        chatBody.appendChild(messageDiv);
        chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Function to add loading spinner
    function addLoadingSpinner() {
        const spinnerDiv = document.createElement("div");
        spinnerDiv.className = "loading-spinner";
        spinnerDiv.id = "loadingSpinner";
        spinnerDiv.innerHTML = `
            <div></div><div></div><div></div>
        `;
        chatBody.appendChild(spinnerDiv);
        chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Function to remove loading spinner
    function removeLoadingSpinner() {
        const spinnerDiv = document.getElementById("loadingSpinner");
        if (spinnerDiv) spinnerDiv.remove();
    }

    // Function to add a menu card to the chat
    function addMenuCard(dishName, description, price) {
        const cardDiv = document.createElement("div");
        cardDiv.className = "menu-card";
        cardDiv.innerHTML = `
            <h3>${dishName}</h3>
            <p>${description}</p>
            <p><span>Price:</span> â‚¹${price}</p>
        `;
        chatBody.appendChild(cardDiv);
        chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Fetch menu data from backend
    async function fetchMenu(query) {
        addLoadingSpinner();
        try {
            const response = await fetch(`http://localhost:8080/api/menu/search?query=${encodeURIComponent(query)}`);
            if (!response.ok) throw new Error("Failed to fetch data from backend.");
            return await response.json();
        } catch (error) {
            console.error(error);
            return null;
        } finally {
            removeLoadingSpinner();
        }
    }

    // Handle user input and bot response
    async function handleSendMessage() {
        const userMessage = userInput.value.trim();
        if (userMessage === "") return;

        addMessage(userMessage, "user");
        userInput.value = "";

        const responseData = await fetchMenu(userMessage);

        if (responseData) {
            const { menuList, enhancedMessage } = responseData;

            addMessage(enhancedMessage || "Here are the menu items you requested:", "bot");

            if (menuList && menuList.length > 0) {
                menuList.forEach(item => addMenuCard(item.dishName, item.description, item.price));
            } else {
                //addMessage("Sorry, I couldn't find any items matching your query.", "bot");
            }
        } else {
            addMessage("I'm having trouble reaching the server. Please try again later.", "bot");
        }
    }

    // Add event listeners
    sendButton.addEventListener("click", handleSendMessage);
    userInput.addEventListener("keypress", e => {
        if (e.key === "Enter") handleSendMessage();
    });

    // Greet the user when page loads
    addMessage("Hello! I'm your Restaurant Chatbot. How can I assist you today?", "bot");
</script>
</body>
</html>